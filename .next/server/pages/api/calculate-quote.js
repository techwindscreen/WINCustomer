"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/calculate-quote";
exports.ids = ["pages/api/calculate-quote"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcalculate-quote&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fcalculate-quote.ts&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcalculate-quote&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fcalculate-quote.ts&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_calculate_quote_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/calculate-quote.ts */ \"(api)/./pages/api/calculate-quote.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_calculate_quote_ts__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_calculate_quote_ts__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/calculate-quote\",\n        pathname: \"/api/calculate-quote\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_calculate_quote_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNhbGN1bGF0ZS1xdW90ZSZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGY2FsY3VsYXRlLXF1b3RlLnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNFO0FBQzFEO0FBQzJEO0FBQzNEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQywwREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsMERBQVE7QUFDcEM7QUFDTyx3QkFBd0IseUdBQW1CO0FBQ2xEO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvY2FsY3VsYXRlLXF1b3RlLnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jYWxjdWxhdGUtcXVvdGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jYWxjdWxhdGUtcXVvdGVcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiAnJyxcbiAgICAgICAgZmlsZW5hbWU6ICcnXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcalculate-quote&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fcalculate-quote.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/supabaseClient.ts":
/*!*******************************!*\
  !*** ./lib/supabaseClient.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabase: () => (/* binding */ supabase)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n\nconst supabaseUrl = \"https://julpwjxzrlkbxdbphrdy.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1bHB3anh6cmxrYnhkYnBocmR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc0MTQ4NDUsImV4cCI6MjA1Mjk5MDg0NX0.rynZAq6bjPlpfyTaxHYcs8FdVdTo_gy95lazi2Kt5RY\";\nif (!supabaseUrl) {\n    throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL environment variable');\n}\nif (!supabaseAnonKey) {\n    throw new Error('Missing NEXT_PUBLIC_SUPABASE_ANON_KEY environment variable');\n}\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvc3VwYWJhc2VDbGllbnQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQW9EO0FBRXBELE1BQU1DLGNBQWNDLDBDQUFvQztBQUN4RCxNQUFNRyxrQkFBa0JILGtOQUF5QztBQUVqRSxJQUFJLENBQUNELGFBQWE7SUFDaEIsTUFBTSxJQUFJTSxNQUFNO0FBQ2xCO0FBRUEsSUFBSSxDQUFDRixpQkFBaUI7SUFDcEIsTUFBTSxJQUFJRSxNQUFNO0FBQ2xCO0FBRU8sTUFBTUMsV0FBV1IsbUVBQVlBLENBQUNDLGFBQWFJLGlCQUFnQiIsInNvdXJjZXMiOlsiL1VzZXJzL211aGFtbWFkYWxpL0Rlc2t0b3AvV2luZHNjcmVlbkNvbXBhcmUvd2luZHNoaWVsZF9jb21wYXJlL1dpbmRDb21wYXJlL2xpYi9zdXBhYmFzZUNsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVk7XG5cbmlmICghc3VwYWJhc2VVcmwpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZScpXG59XG5cbmlmICghc3VwYWJhc2VBbm9uS2V5KSB7XG4gIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZScpXG59XG5cbmV4cG9ydCBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KSAiXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50Iiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VBbm9uS2V5IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJFcnJvciIsInN1cGFiYXNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/supabaseClient.ts\n");

/***/ }),

/***/ "(api)/./pages/api/calculate-quote.ts":
/*!**************************************!*\
  !*** ./pages/api/calculate-quote.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_supabaseClient__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/supabaseClient */ \"(api)/./lib/supabaseClient.ts\");\n\n// Fetch vehicle val data from UK Vehicle Data API\nasync function fetchVehicleValuation(registration) {\n    try {\n        const apiKey = process.env.UK_VEHICLE_DATA_API_KEY;\n        if (!apiKey) {\n            console.error('UK_VEHICLE_DATA_API_KEY environment variable is not set');\n            return null;\n        }\n        console.log(`Fetching valuation data for reg: ${registration}`);\n        const response = await fetch(`https://uk1.ukvehicledata.co.uk/api/datapackage/ValuationData?v=2&api_nullitems=1&auth_apikey=${apiKey}&key_VRM=${registration}`, {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json'\n            }\n        });\n        const data = await response.json();\n        // console.log('Full Val API response:', JSON.stringify(data, null, 2)); // debug - remove later\n        if (data.Response?.StatusCode === \"Success\") {\n            console.log('API call successful, checking for val data...');\n            // Check the correct path for valuation data\n            const dataItems = data.Response.DataItems;\n            if (dataItems && dataItems.ValuationList) {\n                console.log('ValuationList found:', JSON.stringify(dataItems.ValuationList, null, 2));\n                const otrValue = dataItems.ValuationList.OTR;\n                if (otrValue) {\n                    console.log(`OTR value found: £${otrValue}`);\n                    return parseFloat(otrValue);\n                } else {\n                    console.log('OTR value not found in ValuationList');\n                    console.log('Available fields in ValuationList:', Object.keys(dataItems.ValuationList));\n                }\n            } else {\n                console.log('ValuationList not found in DataItems');\n                console.log('Available DataItems fields:', dataItems ? Object.keys(dataItems) : 'None');\n            }\n        } else {\n            console.log(`API call failed with status: ${data.Response?.StatusCode}`);\n            console.log(`Status message: ${data.Response?.StatusMessage}`);\n        }\n        return null;\n    } catch (error) {\n        console.error('Error fetching vehicle valuation:', error);\n        return null;\n    }\n}\n// Calculate materials cost based on OTR price and window type\n// Example calc: For OTR price £20,000 with Windscreen + Front Driver Door + Rear Window + etc:\n// - Windscreen: 1.2% × £20,000 = £240\n// - Front Driver Door: 0.25% × £20,000 = £50  \n// - Rear Window: 0.5% × £20,000 = £100\n// - etc... Total: £540 (+ £30 per window if tinted)\nfunction calculateMaterialsCost(otrPrice, selectedWindows, glassColor) {\n    if (!otrPrice || isNaN(otrPrice)) {\n        console.log('OTR price not available, using min materials cost of £70');\n        return {\n            totalCost: 70,\n            windowBreakdown: [\n                {\n                    windowId: 'fallback',\n                    name: 'Minimum Glass Cost',\n                    baseCost: 70,\n                    privacyCost: 0,\n                    totalCost: 70\n                }\n            ]\n        };\n    }\n    // Window type percentage multipliers based on OTR price\n    // These percentages are based on industry standards... sort of\n    const windowOTRPercentages = {\n        'jqvmap1_ws': 0.012,\n        'jqvmap1_rw': 0.005,\n        'jqvmap1_df': 0.0025,\n        'jqvmap1_dg': 0.0025,\n        'jqvmap1_dr': 0.0025,\n        'jqvmap1_dd': 0.0025,\n        'jqvmap1_vp': 0.005,\n        'jqvmap1_vf': 0.005,\n        'jqvmap1_vr': 0.005,\n        'jqvmap1_vg': 0.005,\n        'jqvmap1_qr': 0.004,\n        'jqvmap1_qg': 0.004 // Rear Driver Quarter - 0.4% (quarter)\n    };\n    let totalMaterialsCost = 0;\n    const windowBreakdown = [];\n    if (selectedWindows && Array.isArray(selectedWindows)) {\n        for (const windowId of selectedWindows){\n            const percentage = windowOTRPercentages[windowId];\n            const windowName = GLASS_PRICING.windows[windowId]?.name || windowId;\n            if (percentage) {\n                const windowCost = otrPrice * percentage;\n                // Check for privacy/tinting and add £30 if applicable\n                let privacyCost = 0;\n                if (glassColor && glassColor[windowId] === 'Tinted Black') {\n                    privacyCost = 30;\n                }\n                const totalWindowCost = windowCost + privacyCost;\n                totalMaterialsCost += totalWindowCost;\n                windowBreakdown.push({\n                    windowId,\n                    name: windowName,\n                    baseCost: Math.round(windowCost * 100) / 100,\n                    privacyCost,\n                    totalCost: Math.round(totalWindowCost * 100) / 100\n                });\n                const privacyNote = privacyCost > 0 ? ` + £${privacyCost} (privacy)` : '';\n                console.log(`Window ${windowId}: ${percentage * 100}% of £${otrPrice} = £${windowCost.toFixed(2)}${privacyNote} = £${totalWindowCost.toFixed(2)}`);\n            } else {\n                console.log(`Unknown window type: ${windowId}, using default 0.25% of OTR`);\n                const windowCost = otrPrice * 0.0025; // Default fallback\n                // Check for privacy/tinting\n                let privacyCost = 0;\n                if (glassColor && glassColor[windowId] === 'Tinted Black') {\n                    privacyCost = 30;\n                }\n                const totalWindowCost = windowCost + privacyCost;\n                totalMaterialsCost += totalWindowCost;\n                windowBreakdown.push({\n                    windowId,\n                    name: windowName,\n                    baseCost: Math.round(windowCost * 100) / 100,\n                    privacyCost,\n                    totalCost: Math.round(totalWindowCost * 100) / 100\n                });\n                const privacyNote = privacyCost > 0 ? ` + £${privacyCost} (privacy)` : '';\n                console.log(`Window ${windowId} (unknown): 0.25% of £${otrPrice} = £${windowCost.toFixed(2)}${privacyNote} = £${totalWindowCost.toFixed(2)}`);\n            }\n        }\n    }\n    // Make sure min materials cost is £70\n    const finalCost = Math.max(totalMaterialsCost, 70);\n    console.log(`Total materials cost: £${totalMaterialsCost.toFixed(2)}, Final cost (min £70): £${finalCost.toFixed(2)}`);\n    return {\n        totalCost: Math.round(finalCost * 100) / 100,\n        windowBreakdown\n    };\n}\n// Pricing constants for modifiers and add-ons\nconst GLASS_PRICING = {\n    // Window type multipliers (relative to base quote price)\n    windows: {\n        'jqvmap1_ws': {\n            multiplier: 1.0,\n            name: 'Windscreen'\n        },\n        'jqvmap1_rw': {\n            multiplier: 0.8,\n            name: 'Rear Window'\n        },\n        'jqvmap1_df': {\n            multiplier: 0.5,\n            name: 'Front Passenger Door'\n        },\n        'jqvmap1_dg': {\n            multiplier: 0.5,\n            name: 'Front Driver Door'\n        },\n        'jqvmap1_dr': {\n            multiplier: 0.45,\n            name: 'Rear Passenger Door'\n        },\n        'jqvmap1_dd': {\n            multiplier: 0.45,\n            name: 'Rear Driver Door'\n        },\n        'jqvmap1_vp': {\n            multiplier: 0.25,\n            name: 'Front Passenger Vent'\n        },\n        'jqvmap1_vf': {\n            multiplier: 0.25,\n            name: 'Front Driver Vent'\n        },\n        'jqvmap1_vr': {\n            multiplier: 0.2,\n            name: 'Rear Passenger Vent'\n        },\n        'jqvmap1_vg': {\n            multiplier: 0.2,\n            name: 'Rear Driver Vent'\n        },\n        'jqvmap1_qr': {\n            multiplier: 0.3,\n            name: 'Rear Passenger Quarter'\n        },\n        'jqvmap1_qg': {\n            multiplier: 0.3,\n            name: 'Rear Driver Quarter'\n        }\n    },\n    // Note: Damage type multipliers now handled in calculateMaterialsCost func\n    // Spec add-ons (flat fees)\n    specifications: {\n        'Rain Sensor': 25,\n        'Sensor': 25,\n        'Heated': 35,\n        'Camera': 50,\n        'Heads Up Display': 75,\n        'HUD': 75,\n        'Aerial Antenna': 15,\n        'No Modification': 0,\n        'Not Sure?': 10 // Small buffer for unknown specs\n    },\n    // Glass type multipliers\n    glassTypes: {\n        'OEM': 1.4,\n        'OEE': 1.0,\n        'standard': 1.0\n    }\n};\nasync function handler(req, res) {\n    if (req.method !== 'POST') {\n        return res.status(405).json({\n            message: 'Method not allowed'\n        });\n    }\n    try {\n        const { vehicleDetails, windowSpecifications, selectedWindows, windowDamage, deliveryType, glassType, glassColor } = req.body;\n        const quoteId = req.body.quoteId || `WC${Date.now()}${Math.random().toString(36).substr(2, 5).toUpperCase()}`;\n        if (!vehicleDetails?.registration) {\n            return res.status(400).json({\n                message: 'Vehicle registration is required'\n            });\n        }\n        console.log('Calculating quote with data:', {\n            selectedWindows,\n            windowDamage,\n            windowSpecifications,\n            glassType,\n            deliveryType,\n            glassColor,\n            registration: vehicleDetails.registration\n        });\n        // Fetch vehicle valuation data\n        const otrValue = await fetchVehicleValuation(vehicleDetails.registration);\n        // NEW PRICING STRUCTURE\n        // Base labour cost per window (scales with number of windows)\n        const baseLabourPerWindow = 140;\n        // Calculate total labour cost based on number of windows\n        const numWindows = selectedWindows ? selectedWindows.length : 1;\n        const labourMultiplier = numWindows === 1 ? 1 : numWindows === 2 ? 1.6 : numWindows === 3 ? 2.0 : numWindows >= 4 ? 2.3 : 1;\n        const labourCost = Math.round(baseLabourPerWindow * labourMultiplier);\n        console.log(`Labour calculation: ${numWindows} windows × base £${baseLabourPerWindow} × ${labourMultiplier} multiplier = £${labourCost}`);\n        // Calculate materials cost based on OTR price and window types\n        const materialsResult = calculateMaterialsCost(otrValue, selectedWindows, glassColor);\n        let materialsCost = materialsResult.totalCost;\n        // Apply specification costs to materials\n        let specificationsCost = 0;\n        if (windowSpecifications && Array.isArray(windowSpecifications)) {\n            specificationsCost = windowSpecifications.reduce((total, spec)=>{\n                const specCost = spec in GLASS_PRICING.specifications ? GLASS_PRICING.specifications[spec] : 0;\n                return total + specCost;\n            }, 0);\n        }\n        materialsCost += specificationsCost;\n        // Apply glass type multiplier to materials\n        const glassMultiplier = glassType && glassType in GLASS_PRICING.glassTypes ? GLASS_PRICING.glassTypes[glassType] : 1.0;\n        materialsCost *= glassMultiplier;\n        // Calculate subtotal (labour + materials)\n        const subtotal = labourCost + materialsCost;\n        // Add 20% service fee on labour + materials\n        const serviceFee = subtotal * 0.2;\n        const totalBeforeVAT = subtotal + serviceFee;\n        // Add 20% VAT on the total\n        const vat = totalBeforeVAT * 0.2;\n        let totalPrice = totalBeforeVAT + vat;\n        // Apply delivery type fee\n        if (deliveryType === 'express') {\n            totalPrice += 90; // £90 additional for express delivery\n        }\n        // Round to nearest pound\n        totalPrice = Math.round(totalPrice);\n        // Ensure minimum total price is still £70\n        totalPrice = Math.max(totalPrice, 70);\n        // Create detailed breakdown for transparency\n        const breakdown = {\n            windowCosts: materialsResult.windowBreakdown,\n            specificationCosts: specificationsCost,\n            serviceFee: Math.round(serviceFee * 100) / 100,\n            glassTypeMultiplier: glassMultiplier,\n            baseTotal: Math.round(subtotal * 100) / 100,\n            vehicleBasedPrice: materialsResult.totalCost,\n            otrPrice: otrValue\n        };\n        // Add detailed breakdown info for debugging\n        console.log('Price Breakdown:', {\n            labourCost,\n            materialsCost: Math.round(materialsCost * 100) / 100,\n            subtotal: Math.round(subtotal * 100) / 100,\n            serviceFee: Math.round(serviceFee * 100) / 100,\n            totalBeforeVAT: Math.round(totalBeforeVAT * 100) / 100,\n            vat: Math.round(vat * 100) / 100,\n            finalPrice: totalPrice,\n            glassType,\n            deliveryType\n        });\n        try {\n            // First, try to update the existing record in Supabase\n            const { data: updateData, error: updateError } = await _lib_supabaseClient__WEBPACK_IMPORTED_MODULE_0__.supabase.from('MasterCustomer').update({\n                quote_price: totalPrice,\n                service_type: deliveryType,\n                glass_type: glassType,\n                otr_price: otrValue\n            }).eq('quote_id', quoteId).select();\n            if (updateError || !updateData || updateData.length === 0) {\n                console.log('Update failed or no record found, attempting upsert...');\n                // If update fails or no record exists, create a new record\n                const { data: insertData, error: insertError } = await _lib_supabaseClient__WEBPACK_IMPORTED_MODULE_0__.supabase.from('MasterCustomer').insert({\n                    quote_id: quoteId,\n                    quote_price: totalPrice,\n                    service_type: deliveryType,\n                    glass_type: glassType,\n                    otr_price: otrValue,\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString()\n                }).select();\n                if (insertError) {\n                    console.error('Supabase insert error:', insertError);\n                } else {\n                    console.log('Successfully created new quote record with price:', totalPrice);\n                }\n            } else {\n                console.log('Successfully updated quote price in Supabase:', totalPrice);\n            }\n        } catch (supabaseError) {\n            console.error('Supabase error:', supabaseError);\n        // Continue execution even if Supabase operation fails\n        }\n        return res.status(200).json({\n            success: true,\n            price: totalPrice,\n            quoteId,\n            breakdown: {\n                ...breakdown,\n                // Add detailed breakdown for frontend display\n                labourCost: labourCost,\n                materialsCost: Math.round(materialsCost * 100) / 100,\n                subtotal: Math.round(subtotal * 100) / 100,\n                serviceFee: Math.round(serviceFee * 100) / 100,\n                totalBeforeVAT: Math.round(totalBeforeVAT * 100) / 100,\n                vat: Math.round(vat * 100) / 100,\n                finalPrice: totalPrice,\n                glassType: glassType,\n                deliveryType: deliveryType\n            }\n        });\n    } catch (error) {\n        console.error('Error calculating quote:', error);\n        return res.status(500).json({\n            message: 'Failed to calculate quote'\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvY2FsY3VsYXRlLXF1b3RlLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQ29EO0FBMEJwRCxrREFBa0Q7QUFDbEQsZUFBZUMsc0JBQXNCQyxZQUFvQjtJQUN2RCxJQUFJO1FBQ0YsTUFBTUMsU0FBU0MsUUFBUUMsR0FBRyxDQUFDQyx1QkFBdUI7UUFFbEQsSUFBSSxDQUFDSCxRQUFRO1lBQ1hJLFFBQVFDLEtBQUssQ0FBQztZQUNkLE9BQU87UUFDVDtRQUVBRCxRQUFRRSxHQUFHLENBQUMsQ0FBQyxpQ0FBaUMsRUFBRVAsY0FBYztRQUU5RCxNQUFNUSxXQUFXLE1BQU1DLE1BQ3JCLENBQUMsOEZBQThGLEVBQUVSLE9BQU8sU0FBUyxFQUFFRCxjQUFjLEVBQ2pJO1lBQ0VVLFFBQVE7WUFDUkMsU0FBUztnQkFDUCxnQkFBZ0I7WUFDbEI7UUFDRjtRQUdGLE1BQU1DLE9BQU8sTUFBTUosU0FBU0ssSUFBSTtRQUNoQyxnR0FBZ0c7UUFFaEcsSUFBSUQsS0FBS0UsUUFBUSxFQUFFQyxlQUFlLFdBQVc7WUFDM0NWLFFBQVFFLEdBQUcsQ0FBQztZQUVaLDRDQUE0QztZQUM1QyxNQUFNUyxZQUFZSixLQUFLRSxRQUFRLENBQUNHLFNBQVM7WUFDekMsSUFBSUQsYUFBYUEsVUFBVUUsYUFBYSxFQUFFO2dCQUN4Q2IsUUFBUUUsR0FBRyxDQUFDLHdCQUF3QlksS0FBS0MsU0FBUyxDQUFDSixVQUFVRSxhQUFhLEVBQUUsTUFBTTtnQkFFbEYsTUFBTUcsV0FBV0wsVUFBVUUsYUFBYSxDQUFDSSxHQUFHO2dCQUU1QyxJQUFJRCxVQUFVO29CQUNaaEIsUUFBUUUsR0FBRyxDQUFDLENBQUMsa0JBQWtCLEVBQUVjLFVBQVU7b0JBQzNDLE9BQU9FLFdBQVdGO2dCQUNwQixPQUFPO29CQUNMaEIsUUFBUUUsR0FBRyxDQUFDO29CQUNaRixRQUFRRSxHQUFHLENBQUMsc0NBQXNDaUIsT0FBT0MsSUFBSSxDQUFDVCxVQUFVRSxhQUFhO2dCQUN2RjtZQUNGLE9BQU87Z0JBQ0xiLFFBQVFFLEdBQUcsQ0FBQztnQkFDWkYsUUFBUUUsR0FBRyxDQUFDLCtCQUErQlMsWUFBWVEsT0FBT0MsSUFBSSxDQUFDVCxhQUFhO1lBQ2xGO1FBQ0YsT0FBTztZQUNMWCxRQUFRRSxHQUFHLENBQUMsQ0FBQyw2QkFBNkIsRUFBRUssS0FBS0UsUUFBUSxFQUFFQyxZQUFZO1lBQ3ZFVixRQUFRRSxHQUFHLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRUssS0FBS0UsUUFBUSxFQUFFWSxlQUFlO1FBQy9EO1FBRUEsT0FBTztJQUNULEVBQUUsT0FBT3BCLE9BQU87UUFDZEQsUUFBUUMsS0FBSyxDQUFDLHFDQUFxQ0E7UUFDbkQsT0FBTztJQUNUO0FBQ0Y7QUFFQSw4REFBOEQ7QUFDOUQsK0ZBQStGO0FBQy9GLHNDQUFzQztBQUN0QywrQ0FBK0M7QUFDL0MsdUNBQXVDO0FBQ3ZDLG9EQUFvRDtBQUNwRCxTQUFTcUIsdUJBQXVCQyxRQUF1QixFQUFFQyxlQUF5QixFQUFFQyxVQUFtQztJQUNySCxJQUFJLENBQUNGLFlBQVlHLE1BQU1ILFdBQVc7UUFDaEN2QixRQUFRRSxHQUFHLENBQUM7UUFDWixPQUFPO1lBQ0x5QixXQUFXO1lBQ1hDLGlCQUFpQjtnQkFBQztvQkFDaEJDLFVBQVU7b0JBQ1ZDLE1BQU07b0JBQ05DLFVBQVU7b0JBQ1ZDLGFBQWE7b0JBQ2JMLFdBQVc7Z0JBQ2I7YUFBRTtRQUNKO0lBQ0Y7SUFFQSx3REFBd0Q7SUFDeEQsK0RBQStEO0lBQy9ELE1BQU1NLHVCQUF1QjtRQUMzQixjQUFjO1FBQ2QsY0FBYztRQUNkLGNBQWM7UUFDZCxjQUFjO1FBQ2QsY0FBYztRQUNkLGNBQWM7UUFDZCxjQUFjO1FBQ2QsY0FBYztRQUNkLGNBQWM7UUFDZCxjQUFjO1FBQ2QsY0FBYztRQUNkLGNBQWMsTUFBVSx1Q0FBdUM7SUFDakU7SUFFQSxJQUFJQyxxQkFBcUI7SUFDekIsTUFBTU4sa0JBQWdDLEVBQUU7SUFFeEMsSUFBSUosbUJBQW1CVyxNQUFNQyxPQUFPLENBQUNaLGtCQUFrQjtRQUNyRCxLQUFLLE1BQU1LLFlBQVlMLGdCQUFpQjtZQUN0QyxNQUFNYSxhQUFhSixvQkFBb0IsQ0FBQ0osU0FBUztZQUNqRCxNQUFNUyxhQUFhQyxjQUFjQyxPQUFPLENBQUNYLFNBQXFCLEVBQUVDLFFBQVFEO1lBRXhFLElBQUlRLFlBQVk7Z0JBQ2QsTUFBTUksYUFBYWxCLFdBQVdjO2dCQUU5QixzREFBc0Q7Z0JBQ3RELElBQUlMLGNBQWM7Z0JBQ2xCLElBQUlQLGNBQWNBLFVBQVUsQ0FBQ0ksU0FBUyxLQUFLLGdCQUFnQjtvQkFDekRHLGNBQWM7Z0JBQ2hCO2dCQUVBLE1BQU1VLGtCQUFrQkQsYUFBYVQ7Z0JBQ3JDRSxzQkFBc0JRO2dCQUV0QmQsZ0JBQWdCZSxJQUFJLENBQUM7b0JBQ25CZDtvQkFDQUMsTUFBTVE7b0JBQ05QLFVBQVVhLEtBQUtDLEtBQUssQ0FBQ0osYUFBYSxPQUFPO29CQUN6Q1Q7b0JBQ0FMLFdBQVdpQixLQUFLQyxLQUFLLENBQUNILGtCQUFrQixPQUFPO2dCQUNqRDtnQkFFQSxNQUFNSSxjQUFjZCxjQUFjLElBQUksQ0FBQyxJQUFJLEVBQUVBLFlBQVksVUFBVSxDQUFDLEdBQUc7Z0JBQ3ZFaEMsUUFBUUUsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFMkIsU0FBUyxFQUFFLEVBQUVRLGFBQWEsSUFBSSxNQUFNLEVBQUVkLFNBQVMsSUFBSSxFQUFFa0IsV0FBV00sT0FBTyxDQUFDLEtBQUtELFlBQVksSUFBSSxFQUFFSixnQkFBZ0JLLE9BQU8sQ0FBQyxJQUFJO1lBQ25KLE9BQU87Z0JBQ0wvQyxRQUFRRSxHQUFHLENBQUMsQ0FBQyxxQkFBcUIsRUFBRTJCLFNBQVMsNEJBQTRCLENBQUM7Z0JBQzFFLE1BQU1ZLGFBQWFsQixXQUFXLFFBQVEsbUJBQW1CO2dCQUV6RCw0QkFBNEI7Z0JBQzVCLElBQUlTLGNBQWM7Z0JBQ2xCLElBQUlQLGNBQWNBLFVBQVUsQ0FBQ0ksU0FBUyxLQUFLLGdCQUFnQjtvQkFDekRHLGNBQWM7Z0JBQ2hCO2dCQUVBLE1BQU1VLGtCQUFrQkQsYUFBYVQ7Z0JBQ3JDRSxzQkFBc0JRO2dCQUV0QmQsZ0JBQWdCZSxJQUFJLENBQUM7b0JBQ25CZDtvQkFDQUMsTUFBTVE7b0JBQ05QLFVBQVVhLEtBQUtDLEtBQUssQ0FBQ0osYUFBYSxPQUFPO29CQUN6Q1Q7b0JBQ0FMLFdBQVdpQixLQUFLQyxLQUFLLENBQUNILGtCQUFrQixPQUFPO2dCQUNqRDtnQkFFQSxNQUFNSSxjQUFjZCxjQUFjLElBQUksQ0FBQyxJQUFJLEVBQUVBLFlBQVksVUFBVSxDQUFDLEdBQUc7Z0JBQ3ZFaEMsUUFBUUUsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFMkIsU0FBUyxzQkFBc0IsRUFBRU4sU0FBUyxJQUFJLEVBQUVrQixXQUFXTSxPQUFPLENBQUMsS0FBS0QsWUFBWSxJQUFJLEVBQUVKLGdCQUFnQkssT0FBTyxDQUFDLElBQUk7WUFDOUk7UUFDRjtJQUNGO0lBRUEsc0NBQXNDO0lBQ3RDLE1BQU1DLFlBQVlKLEtBQUtLLEdBQUcsQ0FBQ2Ysb0JBQW9CO0lBQy9DbEMsUUFBUUUsR0FBRyxDQUFDLENBQUMsdUJBQXVCLEVBQUVnQyxtQkFBbUJhLE9BQU8sQ0FBQyxHQUFHLHlCQUF5QixFQUFFQyxVQUFVRCxPQUFPLENBQUMsSUFBSTtJQUVySCxPQUFPO1FBQ0xwQixXQUFXaUIsS0FBS0MsS0FBSyxDQUFDRyxZQUFZLE9BQU87UUFDekNwQjtJQUNGO0FBQ0Y7QUFFQSw4Q0FBOEM7QUFDOUMsTUFBTVcsZ0JBQWdCO0lBQ3BCLHlEQUF5RDtJQUN6REMsU0FBUztRQUNQLGNBQWM7WUFBRVUsWUFBWTtZQUFLcEIsTUFBTTtRQUFhO1FBQ3BELGNBQWM7WUFBRW9CLFlBQVk7WUFBS3BCLE1BQU07UUFBYztRQUNyRCxjQUFjO1lBQUVvQixZQUFZO1lBQUtwQixNQUFNO1FBQXVCO1FBQzlELGNBQWM7WUFBRW9CLFlBQVk7WUFBS3BCLE1BQU07UUFBb0I7UUFDM0QsY0FBYztZQUFFb0IsWUFBWTtZQUFNcEIsTUFBTTtRQUFzQjtRQUM5RCxjQUFjO1lBQUVvQixZQUFZO1lBQU1wQixNQUFNO1FBQW1CO1FBQzNELGNBQWM7WUFBRW9CLFlBQVk7WUFBTXBCLE1BQU07UUFBdUI7UUFDL0QsY0FBYztZQUFFb0IsWUFBWTtZQUFNcEIsTUFBTTtRQUFvQjtRQUM1RCxjQUFjO1lBQUVvQixZQUFZO1lBQUtwQixNQUFNO1FBQXNCO1FBQzdELGNBQWM7WUFBRW9CLFlBQVk7WUFBS3BCLE1BQU07UUFBbUI7UUFDMUQsY0FBYztZQUFFb0IsWUFBWTtZQUFLcEIsTUFBTTtRQUF5QjtRQUNoRSxjQUFjO1lBQUVvQixZQUFZO1lBQUtwQixNQUFNO1FBQXNCO0lBQy9EO0lBRUEsMkVBQTJFO0lBRTNFLDJCQUEyQjtJQUMzQnFCLGdCQUFnQjtRQUNkLGVBQWU7UUFDZixVQUFVO1FBQ1YsVUFBVTtRQUNWLFVBQVU7UUFDVixvQkFBb0I7UUFDcEIsT0FBTztRQUNQLGtCQUFrQjtRQUNsQixtQkFBbUI7UUFDbkIsYUFBYSxHQUFJLGlDQUFpQztJQUNwRDtJQUVBLHlCQUF5QjtJQUN6QkMsWUFBWTtRQUNWLE9BQU87UUFDUCxPQUFPO1FBQ1AsWUFBWTtJQUNkO0FBQ0Y7QUFFZSxlQUFlQyxRQUFRQyxHQUFtQixFQUFFQyxHQUFvQjtJQUM3RSxJQUFJRCxJQUFJakQsTUFBTSxLQUFLLFFBQVE7UUFDekIsT0FBT2tELElBQUlDLE1BQU0sQ0FBQyxLQUFLaEQsSUFBSSxDQUFDO1lBQUVpRCxTQUFTO1FBQXFCO0lBQzlEO0lBRUEsSUFBSTtRQUNGLE1BQU0sRUFDSkMsY0FBYyxFQUNkQyxvQkFBb0IsRUFDcEJuQyxlQUFlLEVBQ2ZvQyxZQUFZLEVBQ1pDLFlBQVksRUFDWkMsU0FBUyxFQUNUckMsVUFBVSxFQUNYLEdBQUc2QixJQUFJUyxJQUFJO1FBRVosTUFBTUMsVUFBVVYsSUFBSVMsSUFBSSxDQUFDQyxPQUFPLElBQUksQ0FBQyxFQUFFLEVBQUVDLEtBQUtDLEdBQUcsS0FBS3RCLEtBQUt1QixNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxNQUFNLENBQUMsR0FBRyxHQUFHQyxXQUFXLElBQUk7UUFFN0csSUFBSSxDQUFDWixnQkFBZ0IvRCxjQUFjO1lBQ2pDLE9BQU80RCxJQUFJQyxNQUFNLENBQUMsS0FBS2hELElBQUksQ0FBQztnQkFBRWlELFNBQVM7WUFBbUM7UUFDNUU7UUFFQXpELFFBQVFFLEdBQUcsQ0FBQyxnQ0FBZ0M7WUFDMUNzQjtZQUNBb0M7WUFDQUQ7WUFDQUc7WUFDQUQ7WUFDQXBDO1lBQ0E5QixjQUFjK0QsZUFBZS9ELFlBQVk7UUFDM0M7UUFFQSwrQkFBK0I7UUFDL0IsTUFBTXFCLFdBQVcsTUFBTXRCLHNCQUFzQmdFLGVBQWUvRCxZQUFZO1FBRXhFLHdCQUF3QjtRQUN4Qiw4REFBOEQ7UUFDOUQsTUFBTTRFLHNCQUFzQjtRQUU1Qix5REFBeUQ7UUFDekQsTUFBTUMsYUFBYWhELGtCQUFrQkEsZ0JBQWdCaUQsTUFBTSxHQUFHO1FBQzlELE1BQU1DLG1CQUFtQkYsZUFBZSxJQUFJLElBQ3JCQSxlQUFlLElBQUksTUFDbkJBLGVBQWUsSUFBSSxNQUNuQkEsY0FBYyxJQUFJLE1BQU07UUFFL0MsTUFBTUcsYUFBYS9CLEtBQUtDLEtBQUssQ0FBQzBCLHNCQUFzQkc7UUFFcEQxRSxRQUFRRSxHQUFHLENBQUMsQ0FBQyxvQkFBb0IsRUFBRXNFLFdBQVcsaUJBQWlCLEVBQUVELG9CQUFvQixHQUFHLEVBQUVHLGlCQUFpQixlQUFlLEVBQUVDLFlBQVk7UUFFeEksK0RBQStEO1FBQy9ELE1BQU1DLGtCQUFrQnRELHVCQUF1Qk4sVUFBVVEsaUJBQWlCQztRQUMxRSxJQUFJb0QsZ0JBQWdCRCxnQkFBZ0JqRCxTQUFTO1FBRTdDLHlDQUF5QztRQUN6QyxJQUFJbUQscUJBQXFCO1FBQ3pCLElBQUluQix3QkFBd0J4QixNQUFNQyxPQUFPLENBQUN1Qix1QkFBdUI7WUFDL0RtQixxQkFBcUJuQixxQkFBcUJvQixNQUFNLENBQUMsQ0FBQ0MsT0FBT0M7Z0JBQ3ZELE1BQU1DLFdBQVcsUUFBK0IzQyxjQUFjWSxjQUFjLEdBQ3hFWixjQUFjWSxjQUFjLENBQUM4QixLQUEwQixHQUN2RDtnQkFDSixPQUFPRCxRQUFRRTtZQUNqQixHQUFHO1FBQ0w7UUFDQUwsaUJBQWlCQztRQUVqQiwyQ0FBMkM7UUFDM0MsTUFBTUssa0JBQWtCckIsYUFBYSxhQUE0QnZCLGNBQWNhLFVBQVUsR0FDckZiLGNBQWNhLFVBQVUsQ0FBQ1UsVUFBdUIsR0FDaEQ7UUFDSmUsaUJBQWlCTTtRQUVqQiwwQ0FBMEM7UUFDMUMsTUFBTUMsV0FBV1QsYUFBYUU7UUFFOUIsNENBQTRDO1FBQzVDLE1BQU1RLGFBQWFELFdBQVc7UUFDOUIsTUFBTUUsaUJBQWlCRixXQUFXQztRQUVsQywyQkFBMkI7UUFDM0IsTUFBTUUsTUFBTUQsaUJBQWlCO1FBQzdCLElBQUlFLGFBQWFGLGlCQUFpQkM7UUFFbEMsMEJBQTBCO1FBQzFCLElBQUkxQixpQkFBaUIsV0FBVztZQUM5QjJCLGNBQWMsSUFBSSxzQ0FBc0M7UUFDMUQ7UUFFQSx5QkFBeUI7UUFDekJBLGFBQWE1QyxLQUFLQyxLQUFLLENBQUMyQztRQUV4QiwwQ0FBMEM7UUFDMUNBLGFBQWE1QyxLQUFLSyxHQUFHLENBQUN1QyxZQUFZO1FBRWxDLDZDQUE2QztRQUM3QyxNQUFNQyxZQUE0QjtZQUNoQ0MsYUFBYWQsZ0JBQWdCaEQsZUFBZTtZQUM1QytELG9CQUFvQmI7WUFDcEJPLFlBQVl6QyxLQUFLQyxLQUFLLENBQUN3QyxhQUFhLE9BQU87WUFDM0NPLHFCQUFxQlQ7WUFDckJVLFdBQVdqRCxLQUFLQyxLQUFLLENBQUN1QyxXQUFXLE9BQU87WUFDeENVLG1CQUFtQmxCLGdCQUFnQmpELFNBQVM7WUFDNUNKLFVBQVVQO1FBQ1o7UUFFQSw0Q0FBNEM7UUFDNUNoQixRQUFRRSxHQUFHLENBQUMsb0JBQW9CO1lBQzlCeUU7WUFDQUUsZUFBZWpDLEtBQUtDLEtBQUssQ0FBQ2dDLGdCQUFnQixPQUFPO1lBQ2pETyxVQUFVeEMsS0FBS0MsS0FBSyxDQUFDdUMsV0FBVyxPQUFPO1lBQ3ZDQyxZQUFZekMsS0FBS0MsS0FBSyxDQUFDd0MsYUFBYSxPQUFPO1lBQzNDQyxnQkFBZ0IxQyxLQUFLQyxLQUFLLENBQUN5QyxpQkFBaUIsT0FBTztZQUNuREMsS0FBSzNDLEtBQUtDLEtBQUssQ0FBQzBDLE1BQU0sT0FBTztZQUM3QlEsWUFBWVA7WUFDWjFCO1lBQ0FEO1FBQ0Y7UUFFQSxJQUFJO1lBQ0YsdURBQXVEO1lBQ3ZELE1BQU0sRUFBRXRELE1BQU15RixVQUFVLEVBQUUvRixPQUFPZ0csV0FBVyxFQUFFLEdBQUcsTUFBTXhHLHlEQUFRQSxDQUM1RHlHLElBQUksQ0FBQyxrQkFDTEMsTUFBTSxDQUFDO2dCQUNOQyxhQUFhWjtnQkFDYmEsY0FBY3hDO2dCQUNkeUMsWUFBWXhDO2dCQUNaeUMsV0FBV3ZGO1lBQ2IsR0FDQ3dGLEVBQUUsQ0FBQyxZQUFZeEMsU0FDZnlDLE1BQU07WUFFVCxJQUFJUixlQUFlLENBQUNELGNBQWNBLFdBQVd2QixNQUFNLEtBQUssR0FBRztnQkFDekR6RSxRQUFRRSxHQUFHLENBQUM7Z0JBRVosMkRBQTJEO2dCQUMzRCxNQUFNLEVBQUVLLE1BQU1tRyxVQUFVLEVBQUV6RyxPQUFPMEcsV0FBVyxFQUFFLEdBQUcsTUFBTWxILHlEQUFRQSxDQUM1RHlHLElBQUksQ0FBQyxrQkFDTFUsTUFBTSxDQUFDO29CQUNOQyxVQUFVN0M7b0JBQ1ZvQyxhQUFhWjtvQkFDYmEsY0FBY3hDO29CQUNkeUMsWUFBWXhDO29CQUNaeUMsV0FBV3ZGO29CQUNYOEYsWUFBWSxJQUFJN0MsT0FBTzhDLFdBQVc7b0JBQ2xDQyxZQUFZLElBQUkvQyxPQUFPOEMsV0FBVztnQkFDcEMsR0FDQ04sTUFBTTtnQkFFVCxJQUFJRSxhQUFhO29CQUNmM0csUUFBUUMsS0FBSyxDQUFDLDBCQUEwQjBHO2dCQUMxQyxPQUFPO29CQUNMM0csUUFBUUUsR0FBRyxDQUFDLHFEQUFxRHNGO2dCQUNuRTtZQUNGLE9BQU87Z0JBQ0x4RixRQUFRRSxHQUFHLENBQUMsaURBQWlEc0Y7WUFDL0Q7UUFDRixFQUFFLE9BQU95QixlQUFlO1lBQ3RCakgsUUFBUUMsS0FBSyxDQUFDLG1CQUFtQmdIO1FBQ2pDLHNEQUFzRDtRQUN4RDtRQUVBLE9BQU8xRCxJQUFJQyxNQUFNLENBQUMsS0FBS2hELElBQUksQ0FBQztZQUMxQjBHLFNBQVM7WUFDVEMsT0FBTzNCO1lBQ1B4QjtZQUNBeUIsV0FBVztnQkFDVCxHQUFHQSxTQUFTO2dCQUNaLDhDQUE4QztnQkFDOUNkLFlBQVlBO2dCQUNaRSxlQUFlakMsS0FBS0MsS0FBSyxDQUFDZ0MsZ0JBQWdCLE9BQU87Z0JBQ2pETyxVQUFVeEMsS0FBS0MsS0FBSyxDQUFDdUMsV0FBVyxPQUFPO2dCQUN2Q0MsWUFBWXpDLEtBQUtDLEtBQUssQ0FBQ3dDLGFBQWEsT0FBTztnQkFDM0NDLGdCQUFnQjFDLEtBQUtDLEtBQUssQ0FBQ3lDLGlCQUFpQixPQUFPO2dCQUNuREMsS0FBSzNDLEtBQUtDLEtBQUssQ0FBQzBDLE1BQU0sT0FBTztnQkFDN0JRLFlBQVlQO2dCQUNaMUIsV0FBV0E7Z0JBQ1hELGNBQWNBO1lBQ2hCO1FBQ0Y7SUFDRixFQUFFLE9BQU81RCxPQUFPO1FBQ2RELFFBQVFDLEtBQUssQ0FBQyw0QkFBNEJBO1FBQzFDLE9BQU9zRCxJQUFJQyxNQUFNLENBQUMsS0FBS2hELElBQUksQ0FBQztZQUFFaUQsU0FBUztRQUE0QjtJQUNyRTtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvbXVoYW1tYWRhbGkvRGVza3RvcC9XaW5kc2NyZWVuQ29tcGFyZS93aW5kc2hpZWxkX2NvbXBhcmUvV2luZENvbXBhcmUvcGFnZXMvYXBpL2NhbGN1bGF0ZS1xdW90ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi4vLi4vbGliL3N1cGFiYXNlQ2xpZW50JztcblxuLy8gV2luZG93IElEcyAtIHRoZXNlIG1hdGNoIHRoZSBTVkcgbWFwIGVsZW1lbnQgSURzXG50eXBlIFdpbmRvd0lkID0gJ2pxdm1hcDFfd3MnIHwgJ2pxdm1hcDFfcncnIHwgJ2pxdm1hcDFfZGYnIHwgJ2pxdm1hcDFfZGcnIHwgJ2pxdm1hcDFfZHInIHwgJ2pxdm1hcDFfZGQnIHwgJ2pxdm1hcDFfdnAnIHwgJ2pxdm1hcDFfdmYnIHwgJ2pxdm1hcDFfdnInIHwgJ2pxdm1hcDFfdmcnIHwgJ2pxdm1hcDFfcXInIHwgJ2pxdm1hcDFfcWcnO1xuLy8gTm90ZTogZGFtYWdlIHR5cGVzIGFyZSBjb2xsZWN0ZWQgYnV0IG5vdCB1c2VkIGluIHByaWNpbmcgY2FsY3MgKHlldClcbnR5cGUgU3BlY2lmaWNhdGlvblR5cGUgPSAnUmFpbiBTZW5zb3InIHwgJ1NlbnNvcicgfCAnSGVhdGVkJyB8ICdDYW1lcmEnIHwgJ0hlYWRzIFVwIERpc3BsYXknIHwgJ0hVRCcgfCAnQWVyaWFsIEFudGVubmEnIHwgJ05vIE1vZGlmaWNhdGlvbicgfCAnTm90IFN1cmU/JztcbnR5cGUgR2xhc3NUeXBlID0gJ09FTScgfCAnT0VFJyB8ICdzdGFuZGFyZCc7XG5cbmludGVyZmFjZSBXaW5kb3dDb3N0IHtcbiAgd2luZG93SWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBiYXNlQ29zdDogbnVtYmVyO1xuICBwcml2YWN5Q29zdDogbnVtYmVyO1xuICB0b3RhbENvc3Q6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFByaWNlQnJlYWtkb3duIHtcbiAgd2luZG93Q29zdHM6IFdpbmRvd0Nvc3RbXTtcbiAgc3BlY2lmaWNhdGlvbkNvc3RzOiBudW1iZXI7XG4gIHNlcnZpY2VGZWU6IG51bWJlcjtcbiAgZ2xhc3NUeXBlTXVsdGlwbGllcjogbnVtYmVyO1xuICBiYXNlVG90YWw6IG51bWJlcjtcbiAgdmVoaWNsZUJhc2VkUHJpY2U/OiBudW1iZXI7XG4gIG90clByaWNlPzogbnVtYmVyIHwgbnVsbDtcbn1cblxuLy8gRmV0Y2ggdmVoaWNsZSB2YWwgZGF0YSBmcm9tIFVLIFZlaGljbGUgRGF0YSBBUElcbmFzeW5jIGZ1bmN0aW9uIGZldGNoVmVoaWNsZVZhbHVhdGlvbihyZWdpc3RyYXRpb246IHN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LlVLX1ZFSElDTEVfREFUQV9BUElfS0VZO1xuICAgIFxuICAgIGlmICghYXBpS2V5KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdVS19WRUhJQ0xFX0RBVEFfQVBJX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0Jyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhgRmV0Y2hpbmcgdmFsdWF0aW9uIGRhdGEgZm9yIHJlZzogJHtyZWdpc3RyYXRpb259YCk7XG4gICAgXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgIGBodHRwczovL3VrMS51a3ZlaGljbGVkYXRhLmNvLnVrL2FwaS9kYXRhcGFja2FnZS9WYWx1YXRpb25EYXRhP3Y9MiZhcGlfbnVsbGl0ZW1zPTEmYXV0aF9hcGlrZXk9JHthcGlLZXl9JmtleV9WUk09JHtyZWdpc3RyYXRpb259YCxcbiAgICAgIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAvLyBjb25zb2xlLmxvZygnRnVsbCBWYWwgQVBJIHJlc3BvbnNlOicsIEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDIpKTsgLy8gZGVidWcgLSByZW1vdmUgbGF0ZXJcblxuICAgIGlmIChkYXRhLlJlc3BvbnNlPy5TdGF0dXNDb2RlID09PSBcIlN1Y2Nlc3NcIikge1xuICAgICAgY29uc29sZS5sb2coJ0FQSSBjYWxsIHN1Y2Nlc3NmdWwsIGNoZWNraW5nIGZvciB2YWwgZGF0YS4uLicpO1xuICAgICAgXG4gICAgICAvLyBDaGVjayB0aGUgY29ycmVjdCBwYXRoIGZvciB2YWx1YXRpb24gZGF0YVxuICAgICAgY29uc3QgZGF0YUl0ZW1zID0gZGF0YS5SZXNwb25zZS5EYXRhSXRlbXM7XG4gICAgICBpZiAoZGF0YUl0ZW1zICYmIGRhdGFJdGVtcy5WYWx1YXRpb25MaXN0KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdWYWx1YXRpb25MaXN0IGZvdW5kOicsIEpTT04uc3RyaW5naWZ5KGRhdGFJdGVtcy5WYWx1YXRpb25MaXN0LCBudWxsLCAyKSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBvdHJWYWx1ZSA9IGRhdGFJdGVtcy5WYWx1YXRpb25MaXN0Lk9UUjtcbiAgICAgICAgXG4gICAgICAgIGlmIChvdHJWYWx1ZSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBPVFIgdmFsdWUgZm91bmQ6IMKjJHtvdHJWYWx1ZX1gKTtcbiAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChvdHJWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ09UUiB2YWx1ZSBub3QgZm91bmQgaW4gVmFsdWF0aW9uTGlzdCcpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdBdmFpbGFibGUgZmllbGRzIGluIFZhbHVhdGlvbkxpc3Q6JywgT2JqZWN0LmtleXMoZGF0YUl0ZW1zLlZhbHVhdGlvbkxpc3QpKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1ZhbHVhdGlvbkxpc3Qgbm90IGZvdW5kIGluIERhdGFJdGVtcycpO1xuICAgICAgICBjb25zb2xlLmxvZygnQXZhaWxhYmxlIERhdGFJdGVtcyBmaWVsZHM6JywgZGF0YUl0ZW1zID8gT2JqZWN0LmtleXMoZGF0YUl0ZW1zKSA6ICdOb25lJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKGBBUEkgY2FsbCBmYWlsZWQgd2l0aCBzdGF0dXM6ICR7ZGF0YS5SZXNwb25zZT8uU3RhdHVzQ29kZX1gKTtcbiAgICAgIGNvbnNvbGUubG9nKGBTdGF0dXMgbWVzc2FnZTogJHtkYXRhLlJlc3BvbnNlPy5TdGF0dXNNZXNzYWdlfWApO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbnVsbDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB2ZWhpY2xlIHZhbHVhdGlvbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8gQ2FsY3VsYXRlIG1hdGVyaWFscyBjb3N0IGJhc2VkIG9uIE9UUiBwcmljZSBhbmQgd2luZG93IHR5cGVcbi8vIEV4YW1wbGUgY2FsYzogRm9yIE9UUiBwcmljZSDCozIwLDAwMCB3aXRoIFdpbmRzY3JlZW4gKyBGcm9udCBEcml2ZXIgRG9vciArIFJlYXIgV2luZG93ICsgZXRjOlxuLy8gLSBXaW5kc2NyZWVuOiAxLjIlIMOXIMKjMjAsMDAwID0gwqMyNDBcbi8vIC0gRnJvbnQgRHJpdmVyIERvb3I6IDAuMjUlIMOXIMKjMjAsMDAwID0gwqM1MCAgXG4vLyAtIFJlYXIgV2luZG93OiAwLjUlIMOXIMKjMjAsMDAwID0gwqMxMDBcbi8vIC0gZXRjLi4uIFRvdGFsOiDCozU0MCAoKyDCozMwIHBlciB3aW5kb3cgaWYgdGludGVkKVxuZnVuY3Rpb24gY2FsY3VsYXRlTWF0ZXJpYWxzQ29zdChvdHJQcmljZTogbnVtYmVyIHwgbnVsbCwgc2VsZWN0ZWRXaW5kb3dzOiBzdHJpbmdbXSwgZ2xhc3NDb2xvcj86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiB7IHRvdGFsQ29zdDogbnVtYmVyLCB3aW5kb3dCcmVha2Rvd246IFdpbmRvd0Nvc3RbXSB9IHtcbiAgaWYgKCFvdHJQcmljZSB8fCBpc05hTihvdHJQcmljZSkpIHtcbiAgICBjb25zb2xlLmxvZygnT1RSIHByaWNlIG5vdCBhdmFpbGFibGUsIHVzaW5nIG1pbiBtYXRlcmlhbHMgY29zdCBvZiDCozcwJyk7XG4gICAgcmV0dXJuIHsgXG4gICAgICB0b3RhbENvc3Q6IDcwLCBcbiAgICAgIHdpbmRvd0JyZWFrZG93bjogW3sgXG4gICAgICAgIHdpbmRvd0lkOiAnZmFsbGJhY2snLCBcbiAgICAgICAgbmFtZTogJ01pbmltdW0gR2xhc3MgQ29zdCcsIFxuICAgICAgICBiYXNlQ29zdDogNzAsIFxuICAgICAgICBwcml2YWN5Q29zdDogMCwgXG4gICAgICAgIHRvdGFsQ29zdDogNzAgXG4gICAgICB9XSBcbiAgICB9O1xuICB9XG5cbiAgLy8gV2luZG93IHR5cGUgcGVyY2VudGFnZSBtdWx0aXBsaWVycyBiYXNlZCBvbiBPVFIgcHJpY2VcbiAgLy8gVGhlc2UgcGVyY2VudGFnZXMgYXJlIGJhc2VkIG9uIGluZHVzdHJ5IHN0YW5kYXJkcy4uLiBzb3J0IG9mXG4gIGNvbnN0IHdpbmRvd09UUlBlcmNlbnRhZ2VzID0ge1xuICAgICdqcXZtYXAxX3dzJzogMC4wMTIsICAgIC8vIFdpbmRzY3JlZW4gLSAxLjIlXG4gICAgJ2pxdm1hcDFfcncnOiAwLjAwNSwgICAgLy8gUmVhciBXaW5kb3cgLSAwLjUlXG4gICAgJ2pxdm1hcDFfZGYnOiAwLjAwMjUsICAgLy8gRnJvbnQgUGFzcyBEb29yIC0gMC4yNSUgKHNpZGVzKVxuICAgICdqcXZtYXAxX2RnJzogMC4wMDI1LCAgIC8vIEZyb250IERyaXZlciBEb29yIC0gMC4yNSUgKHNpZGVzKVxuICAgICdqcXZtYXAxX2RyJzogMC4wMDI1LCAgIC8vIFJlYXIgUGFzcyBEb29yIC0gMC4yNSUgKHNpZGVzKVxuICAgICdqcXZtYXAxX2RkJzogMC4wMDI1LCAgIC8vIFJlYXIgRHJpdmVyIERvb3IgLSAwLjI1JSAoc2lkZXMpXG4gICAgJ2pxdm1hcDFfdnAnOiAwLjAwNSwgICAgLy8gRnJvbnQgUGFzcyBWZW50IC0gMC41JSAocXVhcnQgbGlnaHQpXG4gICAgJ2pxdm1hcDFfdmYnOiAwLjAwNSwgICAgLy8gRnJvbnQgRHJpdmVyIFZlbnQgLSAwLjUlIChxdWFydCBsaWdodClcbiAgICAnanF2bWFwMV92cic6IDAuMDA1LCAgICAvLyBSZWFyIFBhc3MgVmVudCAtIDAuNSUgKHF1YXJ0IGxpZ2h0KVxuICAgICdqcXZtYXAxX3ZnJzogMC4wMDUsICAgIC8vIFJlYXIgRHJpdmVyIFZlbnQgLSAwLjUlIChxdWFydCBsaWdodClcbiAgICAnanF2bWFwMV9xcic6IDAuMDA0LCAgICAvLyBSZWFyIFBhc3MgUXVhcnRlciAtIDAuNCUgKHF1YXJ0ZXIpXG4gICAgJ2pxdm1hcDFfcWcnOiAwLjAwNCAgICAgLy8gUmVhciBEcml2ZXIgUXVhcnRlciAtIDAuNCUgKHF1YXJ0ZXIpXG4gIH0gYXMgUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcblxuICBsZXQgdG90YWxNYXRlcmlhbHNDb3N0ID0gMDtcbiAgY29uc3Qgd2luZG93QnJlYWtkb3duOiBXaW5kb3dDb3N0W10gPSBbXTtcblxuICBpZiAoc2VsZWN0ZWRXaW5kb3dzICYmIEFycmF5LmlzQXJyYXkoc2VsZWN0ZWRXaW5kb3dzKSkge1xuICAgIGZvciAoY29uc3Qgd2luZG93SWQgb2Ygc2VsZWN0ZWRXaW5kb3dzKSB7XG4gICAgICBjb25zdCBwZXJjZW50YWdlID0gd2luZG93T1RSUGVyY2VudGFnZXNbd2luZG93SWRdO1xuICAgICAgY29uc3Qgd2luZG93TmFtZSA9IEdMQVNTX1BSSUNJTkcud2luZG93c1t3aW5kb3dJZCBhcyBXaW5kb3dJZF0/Lm5hbWUgfHwgd2luZG93SWQ7XG4gICAgICBcbiAgICAgIGlmIChwZXJjZW50YWdlKSB7XG4gICAgICAgIGNvbnN0IHdpbmRvd0Nvc3QgPSBvdHJQcmljZSAqIHBlcmNlbnRhZ2U7XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBmb3IgcHJpdmFjeS90aW50aW5nIGFuZCBhZGQgwqMzMCBpZiBhcHBsaWNhYmxlXG4gICAgICAgIGxldCBwcml2YWN5Q29zdCA9IDA7XG4gICAgICAgIGlmIChnbGFzc0NvbG9yICYmIGdsYXNzQ29sb3Jbd2luZG93SWRdID09PSAnVGludGVkIEJsYWNrJykge1xuICAgICAgICAgIHByaXZhY3lDb3N0ID0gMzA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHRvdGFsV2luZG93Q29zdCA9IHdpbmRvd0Nvc3QgKyBwcml2YWN5Q29zdDtcbiAgICAgICAgdG90YWxNYXRlcmlhbHNDb3N0ICs9IHRvdGFsV2luZG93Q29zdDtcbiAgICAgICAgXG4gICAgICAgIHdpbmRvd0JyZWFrZG93bi5wdXNoKHtcbiAgICAgICAgICB3aW5kb3dJZCxcbiAgICAgICAgICBuYW1lOiB3aW5kb3dOYW1lLFxuICAgICAgICAgIGJhc2VDb3N0OiBNYXRoLnJvdW5kKHdpbmRvd0Nvc3QgKiAxMDApIC8gMTAwLFxuICAgICAgICAgIHByaXZhY3lDb3N0LFxuICAgICAgICAgIHRvdGFsQ29zdDogTWF0aC5yb3VuZCh0b3RhbFdpbmRvd0Nvc3QgKiAxMDApIC8gMTAwXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcHJpdmFjeU5vdGUgPSBwcml2YWN5Q29zdCA+IDAgPyBgICsgwqMke3ByaXZhY3lDb3N0fSAocHJpdmFjeSlgIDogJyc7XG4gICAgICAgIGNvbnNvbGUubG9nKGBXaW5kb3cgJHt3aW5kb3dJZH06ICR7cGVyY2VudGFnZSAqIDEwMH0lIG9mIMKjJHtvdHJQcmljZX0gPSDCoyR7d2luZG93Q29zdC50b0ZpeGVkKDIpfSR7cHJpdmFjeU5vdGV9ID0gwqMke3RvdGFsV2luZG93Q29zdC50b0ZpeGVkKDIpfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coYFVua25vd24gd2luZG93IHR5cGU6ICR7d2luZG93SWR9LCB1c2luZyBkZWZhdWx0IDAuMjUlIG9mIE9UUmApO1xuICAgICAgICBjb25zdCB3aW5kb3dDb3N0ID0gb3RyUHJpY2UgKiAwLjAwMjU7IC8vIERlZmF1bHQgZmFsbGJhY2tcbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGZvciBwcml2YWN5L3RpbnRpbmdcbiAgICAgICAgbGV0IHByaXZhY3lDb3N0ID0gMDtcbiAgICAgICAgaWYgKGdsYXNzQ29sb3IgJiYgZ2xhc3NDb2xvclt3aW5kb3dJZF0gPT09ICdUaW50ZWQgQmxhY2snKSB7XG4gICAgICAgICAgcHJpdmFjeUNvc3QgPSAzMDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdG90YWxXaW5kb3dDb3N0ID0gd2luZG93Q29zdCArIHByaXZhY3lDb3N0O1xuICAgICAgICB0b3RhbE1hdGVyaWFsc0Nvc3QgKz0gdG90YWxXaW5kb3dDb3N0O1xuICAgICAgICBcbiAgICAgICAgd2luZG93QnJlYWtkb3duLnB1c2goe1xuICAgICAgICAgIHdpbmRvd0lkLFxuICAgICAgICAgIG5hbWU6IHdpbmRvd05hbWUsXG4gICAgICAgICAgYmFzZUNvc3Q6IE1hdGgucm91bmQod2luZG93Q29zdCAqIDEwMCkgLyAxMDAsXG4gICAgICAgICAgcHJpdmFjeUNvc3QsXG4gICAgICAgICAgdG90YWxDb3N0OiBNYXRoLnJvdW5kKHRvdGFsV2luZG93Q29zdCAqIDEwMCkgLyAxMDBcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBwcml2YWN5Tm90ZSA9IHByaXZhY3lDb3N0ID4gMCA/IGAgKyDCoyR7cHJpdmFjeUNvc3R9IChwcml2YWN5KWAgOiAnJztcbiAgICAgICAgY29uc29sZS5sb2coYFdpbmRvdyAke3dpbmRvd0lkfSAodW5rbm93bik6IDAuMjUlIG9mIMKjJHtvdHJQcmljZX0gPSDCoyR7d2luZG93Q29zdC50b0ZpeGVkKDIpfSR7cHJpdmFjeU5vdGV9ID0gwqMke3RvdGFsV2luZG93Q29zdC50b0ZpeGVkKDIpfWApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIE1ha2Ugc3VyZSBtaW4gbWF0ZXJpYWxzIGNvc3QgaXMgwqM3MFxuICBjb25zdCBmaW5hbENvc3QgPSBNYXRoLm1heCh0b3RhbE1hdGVyaWFsc0Nvc3QsIDcwKTtcbiAgY29uc29sZS5sb2coYFRvdGFsIG1hdGVyaWFscyBjb3N0OiDCoyR7dG90YWxNYXRlcmlhbHNDb3N0LnRvRml4ZWQoMil9LCBGaW5hbCBjb3N0IChtaW4gwqM3MCk6IMKjJHtmaW5hbENvc3QudG9GaXhlZCgyKX1gKTtcbiAgXG4gIHJldHVybiB7XG4gICAgdG90YWxDb3N0OiBNYXRoLnJvdW5kKGZpbmFsQ29zdCAqIDEwMCkgLyAxMDAsXG4gICAgd2luZG93QnJlYWtkb3duXG4gIH07XG59XG5cbi8vIFByaWNpbmcgY29uc3RhbnRzIGZvciBtb2RpZmllcnMgYW5kIGFkZC1vbnNcbmNvbnN0IEdMQVNTX1BSSUNJTkcgPSB7XG4gIC8vIFdpbmRvdyB0eXBlIG11bHRpcGxpZXJzIChyZWxhdGl2ZSB0byBiYXNlIHF1b3RlIHByaWNlKVxuICB3aW5kb3dzOiB7XG4gICAgJ2pxdm1hcDFfd3MnOiB7IG11bHRpcGxpZXI6IDEuMCwgbmFtZTogJ1dpbmRzY3JlZW4nIH0sICAgICAgLy8gQmFzZSBtdWx0aXBsaWVyXG4gICAgJ2pxdm1hcDFfcncnOiB7IG11bHRpcGxpZXI6IDAuOCwgbmFtZTogJ1JlYXIgV2luZG93JyB9LCAgICAgLy8gODAlIG9mIHdpbmRzY3JlZW5cbiAgICAnanF2bWFwMV9kZic6IHsgbXVsdGlwbGllcjogMC41LCBuYW1lOiAnRnJvbnQgUGFzc2VuZ2VyIERvb3InIH0sXG4gICAgJ2pxdm1hcDFfZGcnOiB7IG11bHRpcGxpZXI6IDAuNSwgbmFtZTogJ0Zyb250IERyaXZlciBEb29yJyB9LFxuICAgICdqcXZtYXAxX2RyJzogeyBtdWx0aXBsaWVyOiAwLjQ1LCBuYW1lOiAnUmVhciBQYXNzZW5nZXIgRG9vcicgfSxcbiAgICAnanF2bWFwMV9kZCc6IHsgbXVsdGlwbGllcjogMC40NSwgbmFtZTogJ1JlYXIgRHJpdmVyIERvb3InIH0sXG4gICAgJ2pxdm1hcDFfdnAnOiB7IG11bHRpcGxpZXI6IDAuMjUsIG5hbWU6ICdGcm9udCBQYXNzZW5nZXIgVmVudCcgfSxcbiAgICAnanF2bWFwMV92Zic6IHsgbXVsdGlwbGllcjogMC4yNSwgbmFtZTogJ0Zyb250IERyaXZlciBWZW50JyB9LFxuICAgICdqcXZtYXAxX3ZyJzogeyBtdWx0aXBsaWVyOiAwLjIsIG5hbWU6ICdSZWFyIFBhc3NlbmdlciBWZW50JyB9LFxuICAgICdqcXZtYXAxX3ZnJzogeyBtdWx0aXBsaWVyOiAwLjIsIG5hbWU6ICdSZWFyIERyaXZlciBWZW50JyB9LFxuICAgICdqcXZtYXAxX3FyJzogeyBtdWx0aXBsaWVyOiAwLjMsIG5hbWU6ICdSZWFyIFBhc3NlbmdlciBRdWFydGVyJyB9LFxuICAgICdqcXZtYXAxX3FnJzogeyBtdWx0aXBsaWVyOiAwLjMsIG5hbWU6ICdSZWFyIERyaXZlciBRdWFydGVyJyB9XG4gIH0gYXMgUmVjb3JkPFdpbmRvd0lkLCB7IG11bHRpcGxpZXI6IG51bWJlcjsgbmFtZTogc3RyaW5nIH0+LFxuICBcbiAgLy8gTm90ZTogRGFtYWdlIHR5cGUgbXVsdGlwbGllcnMgbm93IGhhbmRsZWQgaW4gY2FsY3VsYXRlTWF0ZXJpYWxzQ29zdCBmdW5jXG4gIFxuICAvLyBTcGVjIGFkZC1vbnMgKGZsYXQgZmVlcylcbiAgc3BlY2lmaWNhdGlvbnM6IHtcbiAgICAnUmFpbiBTZW5zb3InOiAyNSxcbiAgICAnU2Vuc29yJzogMjUsXG4gICAgJ0hlYXRlZCc6IDM1LFxuICAgICdDYW1lcmEnOiA1MCxcbiAgICAnSGVhZHMgVXAgRGlzcGxheSc6IDc1LFxuICAgICdIVUQnOiA3NSxcbiAgICAnQWVyaWFsIEFudGVubmEnOiAxNSxcbiAgICAnTm8gTW9kaWZpY2F0aW9uJzogMCxcbiAgICAnTm90IFN1cmU/JzogMTAgIC8vIFNtYWxsIGJ1ZmZlciBmb3IgdW5rbm93biBzcGVjc1xuICB9IGFzIFJlY29yZDxTcGVjaWZpY2F0aW9uVHlwZSwgbnVtYmVyPixcbiAgXG4gIC8vIEdsYXNzIHR5cGUgbXVsdGlwbGllcnNcbiAgZ2xhc3NUeXBlczoge1xuICAgICdPRU0nOiAxLjQsICAgIC8vIE9yaWdpbmFsIEVxdWlwbWVudCBNYW51ZmFjdHVyZXIgLSBtb3JlIGV4cGVuc2l2ZVxuICAgICdPRUUnOiAxLjAsICAgIC8vIE9yaWdpbmFsIEVxdWlwbWVudCBFcXVpdmFsZW50IC0gc3RhbmRhcmQgcHJpY2VcbiAgICAnc3RhbmRhcmQnOiAxLjBcbiAgfSBhcyBSZWNvcmQ8R2xhc3NUeXBlLCBudW1iZXI+XG59O1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBtZXNzYWdlOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgeyBcbiAgICAgIHZlaGljbGVEZXRhaWxzLCBcbiAgICAgIHdpbmRvd1NwZWNpZmljYXRpb25zLCBcbiAgICAgIHNlbGVjdGVkV2luZG93cyxcbiAgICAgIHdpbmRvd0RhbWFnZSxcbiAgICAgIGRlbGl2ZXJ5VHlwZSxcbiAgICAgIGdsYXNzVHlwZSxcbiAgICAgIGdsYXNzQ29sb3JcbiAgICB9ID0gcmVxLmJvZHk7XG4gICAgXG4gICAgY29uc3QgcXVvdGVJZCA9IHJlcS5ib2R5LnF1b3RlSWQgfHwgYFdDJHtEYXRlLm5vdygpfSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDUpLnRvVXBwZXJDYXNlKCl9YDtcbiAgICBcbiAgICBpZiAoIXZlaGljbGVEZXRhaWxzPy5yZWdpc3RyYXRpb24pIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdWZWhpY2xlIHJlZ2lzdHJhdGlvbiBpcyByZXF1aXJlZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ0NhbGN1bGF0aW5nIHF1b3RlIHdpdGggZGF0YTonLCB7XG4gICAgICBzZWxlY3RlZFdpbmRvd3MsXG4gICAgICB3aW5kb3dEYW1hZ2UsXG4gICAgICB3aW5kb3dTcGVjaWZpY2F0aW9ucyxcbiAgICAgIGdsYXNzVHlwZSxcbiAgICAgIGRlbGl2ZXJ5VHlwZSxcbiAgICAgIGdsYXNzQ29sb3IsXG4gICAgICByZWdpc3RyYXRpb246IHZlaGljbGVEZXRhaWxzLnJlZ2lzdHJhdGlvblxuICAgIH0pO1xuXG4gICAgLy8gRmV0Y2ggdmVoaWNsZSB2YWx1YXRpb24gZGF0YVxuICAgIGNvbnN0IG90clZhbHVlID0gYXdhaXQgZmV0Y2hWZWhpY2xlVmFsdWF0aW9uKHZlaGljbGVEZXRhaWxzLnJlZ2lzdHJhdGlvbik7XG5cbiAgICAvLyBORVcgUFJJQ0lORyBTVFJVQ1RVUkVcbiAgICAvLyBCYXNlIGxhYm91ciBjb3N0IHBlciB3aW5kb3cgKHNjYWxlcyB3aXRoIG51bWJlciBvZiB3aW5kb3dzKVxuICAgIGNvbnN0IGJhc2VMYWJvdXJQZXJXaW5kb3cgPSAxNDA7XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIHRvdGFsIGxhYm91ciBjb3N0IGJhc2VkIG9uIG51bWJlciBvZiB3aW5kb3dzXG4gICAgY29uc3QgbnVtV2luZG93cyA9IHNlbGVjdGVkV2luZG93cyA/IHNlbGVjdGVkV2luZG93cy5sZW5ndGggOiAxO1xuICAgIGNvbnN0IGxhYm91ck11bHRpcGxpZXIgPSBudW1XaW5kb3dzID09PSAxID8gMSA6IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtV2luZG93cyA9PT0gMiA/IDEuNiA6IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtV2luZG93cyA9PT0gMyA/IDIuMCA6IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtV2luZG93cyA+PSA0ID8gMi4zIDogMTtcbiAgICBcbiAgICBjb25zdCBsYWJvdXJDb3N0ID0gTWF0aC5yb3VuZChiYXNlTGFib3VyUGVyV2luZG93ICogbGFib3VyTXVsdGlwbGllcik7XG4gICAgXG4gICAgY29uc29sZS5sb2coYExhYm91ciBjYWxjdWxhdGlvbjogJHtudW1XaW5kb3dzfSB3aW5kb3dzIMOXIGJhc2UgwqMke2Jhc2VMYWJvdXJQZXJXaW5kb3d9IMOXICR7bGFib3VyTXVsdGlwbGllcn0gbXVsdGlwbGllciA9IMKjJHtsYWJvdXJDb3N0fWApO1xuICAgIFxuICAgIC8vIENhbGN1bGF0ZSBtYXRlcmlhbHMgY29zdCBiYXNlZCBvbiBPVFIgcHJpY2UgYW5kIHdpbmRvdyB0eXBlc1xuICAgIGNvbnN0IG1hdGVyaWFsc1Jlc3VsdCA9IGNhbGN1bGF0ZU1hdGVyaWFsc0Nvc3Qob3RyVmFsdWUsIHNlbGVjdGVkV2luZG93cywgZ2xhc3NDb2xvcik7XG4gICAgbGV0IG1hdGVyaWFsc0Nvc3QgPSBtYXRlcmlhbHNSZXN1bHQudG90YWxDb3N0O1xuICAgIFxuICAgIC8vIEFwcGx5IHNwZWNpZmljYXRpb24gY29zdHMgdG8gbWF0ZXJpYWxzXG4gICAgbGV0IHNwZWNpZmljYXRpb25zQ29zdCA9IDA7XG4gICAgaWYgKHdpbmRvd1NwZWNpZmljYXRpb25zICYmIEFycmF5LmlzQXJyYXkod2luZG93U3BlY2lmaWNhdGlvbnMpKSB7XG4gICAgICBzcGVjaWZpY2F0aW9uc0Nvc3QgPSB3aW5kb3dTcGVjaWZpY2F0aW9ucy5yZWR1Y2UoKHRvdGFsLCBzcGVjKSA9PiB7XG4gICAgICAgIGNvbnN0IHNwZWNDb3N0ID0gKHNwZWMgYXMgU3BlY2lmaWNhdGlvblR5cGUpIGluIEdMQVNTX1BSSUNJTkcuc3BlY2lmaWNhdGlvbnNcbiAgICAgICAgICA/IEdMQVNTX1BSSUNJTkcuc3BlY2lmaWNhdGlvbnNbc3BlYyBhcyBTcGVjaWZpY2F0aW9uVHlwZV1cbiAgICAgICAgICA6IDA7XG4gICAgICAgIHJldHVybiB0b3RhbCArIHNwZWNDb3N0O1xuICAgICAgfSwgMCk7XG4gICAgfVxuICAgIG1hdGVyaWFsc0Nvc3QgKz0gc3BlY2lmaWNhdGlvbnNDb3N0O1xuICAgIFxuICAgIC8vIEFwcGx5IGdsYXNzIHR5cGUgbXVsdGlwbGllciB0byBtYXRlcmlhbHNcbiAgICBjb25zdCBnbGFzc011bHRpcGxpZXIgPSBnbGFzc1R5cGUgJiYgKGdsYXNzVHlwZSBhcyBHbGFzc1R5cGUpIGluIEdMQVNTX1BSSUNJTkcuZ2xhc3NUeXBlc1xuICAgICAgPyBHTEFTU19QUklDSU5HLmdsYXNzVHlwZXNbZ2xhc3NUeXBlIGFzIEdsYXNzVHlwZV1cbiAgICAgIDogMS4wO1xuICAgIG1hdGVyaWFsc0Nvc3QgKj0gZ2xhc3NNdWx0aXBsaWVyO1xuICAgIFxuICAgIC8vIENhbGN1bGF0ZSBzdWJ0b3RhbCAobGFib3VyICsgbWF0ZXJpYWxzKVxuICAgIGNvbnN0IHN1YnRvdGFsID0gbGFib3VyQ29zdCArIG1hdGVyaWFsc0Nvc3Q7XG4gICAgXG4gICAgLy8gQWRkIDIwJSBzZXJ2aWNlIGZlZSBvbiBsYWJvdXIgKyBtYXRlcmlhbHNcbiAgICBjb25zdCBzZXJ2aWNlRmVlID0gc3VidG90YWwgKiAwLjI7XG4gICAgY29uc3QgdG90YWxCZWZvcmVWQVQgPSBzdWJ0b3RhbCArIHNlcnZpY2VGZWU7XG4gICAgXG4gICAgLy8gQWRkIDIwJSBWQVQgb24gdGhlIHRvdGFsXG4gICAgY29uc3QgdmF0ID0gdG90YWxCZWZvcmVWQVQgKiAwLjI7XG4gICAgbGV0IHRvdGFsUHJpY2UgPSB0b3RhbEJlZm9yZVZBVCArIHZhdDtcbiAgICBcbiAgICAvLyBBcHBseSBkZWxpdmVyeSB0eXBlIGZlZVxuICAgIGlmIChkZWxpdmVyeVR5cGUgPT09ICdleHByZXNzJykge1xuICAgICAgdG90YWxQcmljZSArPSA5MDsgLy8gwqM5MCBhZGRpdGlvbmFsIGZvciBleHByZXNzIGRlbGl2ZXJ5XG4gICAgfVxuICAgIFxuICAgIC8vIFJvdW5kIHRvIG5lYXJlc3QgcG91bmRcbiAgICB0b3RhbFByaWNlID0gTWF0aC5yb3VuZCh0b3RhbFByaWNlKTtcbiAgICBcbiAgICAvLyBFbnN1cmUgbWluaW11bSB0b3RhbCBwcmljZSBpcyBzdGlsbCDCozcwXG4gICAgdG90YWxQcmljZSA9IE1hdGgubWF4KHRvdGFsUHJpY2UsIDcwKTtcblxuICAgIC8vIENyZWF0ZSBkZXRhaWxlZCBicmVha2Rvd24gZm9yIHRyYW5zcGFyZW5jeVxuICAgIGNvbnN0IGJyZWFrZG93bjogUHJpY2VCcmVha2Rvd24gPSB7XG4gICAgICB3aW5kb3dDb3N0czogbWF0ZXJpYWxzUmVzdWx0LndpbmRvd0JyZWFrZG93biwgLy8gSW5jbHVkZSBkZXRhaWxlZCB3aW5kb3cgY29zdHNcbiAgICAgIHNwZWNpZmljYXRpb25Db3N0czogc3BlY2lmaWNhdGlvbnNDb3N0LFxuICAgICAgc2VydmljZUZlZTogTWF0aC5yb3VuZChzZXJ2aWNlRmVlICogMTAwKSAvIDEwMCxcbiAgICAgIGdsYXNzVHlwZU11bHRpcGxpZXI6IGdsYXNzTXVsdGlwbGllcixcbiAgICAgIGJhc2VUb3RhbDogTWF0aC5yb3VuZChzdWJ0b3RhbCAqIDEwMCkgLyAxMDAsXG4gICAgICB2ZWhpY2xlQmFzZWRQcmljZTogbWF0ZXJpYWxzUmVzdWx0LnRvdGFsQ29zdCxcbiAgICAgIG90clByaWNlOiBvdHJWYWx1ZVxuICAgIH07XG5cbiAgICAvLyBBZGQgZGV0YWlsZWQgYnJlYWtkb3duIGluZm8gZm9yIGRlYnVnZ2luZ1xuICAgIGNvbnNvbGUubG9nKCdQcmljZSBCcmVha2Rvd246Jywge1xuICAgICAgbGFib3VyQ29zdCxcbiAgICAgIG1hdGVyaWFsc0Nvc3Q6IE1hdGgucm91bmQobWF0ZXJpYWxzQ29zdCAqIDEwMCkgLyAxMDAsXG4gICAgICBzdWJ0b3RhbDogTWF0aC5yb3VuZChzdWJ0b3RhbCAqIDEwMCkgLyAxMDAsXG4gICAgICBzZXJ2aWNlRmVlOiBNYXRoLnJvdW5kKHNlcnZpY2VGZWUgKiAxMDApIC8gMTAwLFxuICAgICAgdG90YWxCZWZvcmVWQVQ6IE1hdGgucm91bmQodG90YWxCZWZvcmVWQVQgKiAxMDApIC8gMTAwLFxuICAgICAgdmF0OiBNYXRoLnJvdW5kKHZhdCAqIDEwMCkgLyAxMDAsXG4gICAgICBmaW5hbFByaWNlOiB0b3RhbFByaWNlLFxuICAgICAgZ2xhc3NUeXBlLFxuICAgICAgZGVsaXZlcnlUeXBlXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gRmlyc3QsIHRyeSB0byB1cGRhdGUgdGhlIGV4aXN0aW5nIHJlY29yZCBpbiBTdXBhYmFzZVxuICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVEYXRhLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdNYXN0ZXJDdXN0b21lcicpXG4gICAgICAgIC51cGRhdGUoe1xuICAgICAgICAgIHF1b3RlX3ByaWNlOiB0b3RhbFByaWNlLFxuICAgICAgICAgIHNlcnZpY2VfdHlwZTogZGVsaXZlcnlUeXBlLFxuICAgICAgICAgIGdsYXNzX3R5cGU6IGdsYXNzVHlwZSxcbiAgICAgICAgICBvdHJfcHJpY2U6IG90clZhbHVlXG4gICAgICAgIH0pXG4gICAgICAgIC5lcSgncXVvdGVfaWQnLCBxdW90ZUlkKVxuICAgICAgICAuc2VsZWN0KCk7XG5cbiAgICAgIGlmICh1cGRhdGVFcnJvciB8fCAhdXBkYXRlRGF0YSB8fCB1cGRhdGVEYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb25zb2xlLmxvZygnVXBkYXRlIGZhaWxlZCBvciBubyByZWNvcmQgZm91bmQsIGF0dGVtcHRpbmcgdXBzZXJ0Li4uJyk7XG4gICAgICAgIFxuICAgICAgICAvLyBJZiB1cGRhdGUgZmFpbHMgb3Igbm8gcmVjb3JkIGV4aXN0cywgY3JlYXRlIGEgbmV3IHJlY29yZFxuICAgICAgICBjb25zdCB7IGRhdGE6IGluc2VydERhdGEsIGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAuZnJvbSgnTWFzdGVyQ3VzdG9tZXInKVxuICAgICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgICAgcXVvdGVfaWQ6IHF1b3RlSWQsXG4gICAgICAgICAgICBxdW90ZV9wcmljZTogdG90YWxQcmljZSxcbiAgICAgICAgICAgIHNlcnZpY2VfdHlwZTogZGVsaXZlcnlUeXBlLFxuICAgICAgICAgICAgZ2xhc3NfdHlwZTogZ2xhc3NUeXBlLFxuICAgICAgICAgICAgb3RyX3ByaWNlOiBvdHJWYWx1ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnNlbGVjdCgpO1xuXG4gICAgICAgIGlmIChpbnNlcnRFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1N1cGFiYXNlIGluc2VydCBlcnJvcjonLCBpbnNlcnRFcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSBjcmVhdGVkIG5ldyBxdW90ZSByZWNvcmQgd2l0aCBwcmljZTonLCB0b3RhbFByaWNlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSB1cGRhdGVkIHF1b3RlIHByaWNlIGluIFN1cGFiYXNlOicsIHRvdGFsUHJpY2UpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKHN1cGFiYXNlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1N1cGFiYXNlIGVycm9yOicsIHN1cGFiYXNlRXJyb3IpO1xuICAgICAgLy8gQ29udGludWUgZXhlY3V0aW9uIGV2ZW4gaWYgU3VwYWJhc2Ugb3BlcmF0aW9uIGZhaWxzXG4gICAgfVxuXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBwcmljZTogdG90YWxQcmljZSxcbiAgICAgIHF1b3RlSWQsXG4gICAgICBicmVha2Rvd246IHtcbiAgICAgICAgLi4uYnJlYWtkb3duLFxuICAgICAgICAvLyBBZGQgZGV0YWlsZWQgYnJlYWtkb3duIGZvciBmcm9udGVuZCBkaXNwbGF5XG4gICAgICAgIGxhYm91ckNvc3Q6IGxhYm91ckNvc3QsXG4gICAgICAgIG1hdGVyaWFsc0Nvc3Q6IE1hdGgucm91bmQobWF0ZXJpYWxzQ29zdCAqIDEwMCkgLyAxMDAsXG4gICAgICAgIHN1YnRvdGFsOiBNYXRoLnJvdW5kKHN1YnRvdGFsICogMTAwKSAvIDEwMCxcbiAgICAgICAgc2VydmljZUZlZTogTWF0aC5yb3VuZChzZXJ2aWNlRmVlICogMTAwKSAvIDEwMCxcbiAgICAgICAgdG90YWxCZWZvcmVWQVQ6IE1hdGgucm91bmQodG90YWxCZWZvcmVWQVQgKiAxMDApIC8gMTAwLFxuICAgICAgICB2YXQ6IE1hdGgucm91bmQodmF0ICogMTAwKSAvIDEwMCxcbiAgICAgICAgZmluYWxQcmljZTogdG90YWxQcmljZSxcbiAgICAgICAgZ2xhc3NUeXBlOiBnbGFzc1R5cGUsXG4gICAgICAgIGRlbGl2ZXJ5VHlwZTogZGVsaXZlcnlUeXBlXG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2FsY3VsYXRpbmcgcXVvdGU6JywgZXJyb3IpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gY2FsY3VsYXRlIHF1b3RlJyB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbInN1cGFiYXNlIiwiZmV0Y2hWZWhpY2xlVmFsdWF0aW9uIiwicmVnaXN0cmF0aW9uIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIlVLX1ZFSElDTEVfREFUQV9BUElfS0VZIiwiY29uc29sZSIsImVycm9yIiwibG9nIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJkYXRhIiwianNvbiIsIlJlc3BvbnNlIiwiU3RhdHVzQ29kZSIsImRhdGFJdGVtcyIsIkRhdGFJdGVtcyIsIlZhbHVhdGlvbkxpc3QiLCJKU09OIiwic3RyaW5naWZ5Iiwib3RyVmFsdWUiLCJPVFIiLCJwYXJzZUZsb2F0IiwiT2JqZWN0Iiwia2V5cyIsIlN0YXR1c01lc3NhZ2UiLCJjYWxjdWxhdGVNYXRlcmlhbHNDb3N0Iiwib3RyUHJpY2UiLCJzZWxlY3RlZFdpbmRvd3MiLCJnbGFzc0NvbG9yIiwiaXNOYU4iLCJ0b3RhbENvc3QiLCJ3aW5kb3dCcmVha2Rvd24iLCJ3aW5kb3dJZCIsIm5hbWUiLCJiYXNlQ29zdCIsInByaXZhY3lDb3N0Iiwid2luZG93T1RSUGVyY2VudGFnZXMiLCJ0b3RhbE1hdGVyaWFsc0Nvc3QiLCJBcnJheSIsImlzQXJyYXkiLCJwZXJjZW50YWdlIiwid2luZG93TmFtZSIsIkdMQVNTX1BSSUNJTkciLCJ3aW5kb3dzIiwid2luZG93Q29zdCIsInRvdGFsV2luZG93Q29zdCIsInB1c2giLCJNYXRoIiwicm91bmQiLCJwcml2YWN5Tm90ZSIsInRvRml4ZWQiLCJmaW5hbENvc3QiLCJtYXgiLCJtdWx0aXBsaWVyIiwic3BlY2lmaWNhdGlvbnMiLCJnbGFzc1R5cGVzIiwiaGFuZGxlciIsInJlcSIsInJlcyIsInN0YXR1cyIsIm1lc3NhZ2UiLCJ2ZWhpY2xlRGV0YWlscyIsIndpbmRvd1NwZWNpZmljYXRpb25zIiwid2luZG93RGFtYWdlIiwiZGVsaXZlcnlUeXBlIiwiZ2xhc3NUeXBlIiwiYm9keSIsInF1b3RlSWQiLCJEYXRlIiwibm93IiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ0b1VwcGVyQ2FzZSIsImJhc2VMYWJvdXJQZXJXaW5kb3ciLCJudW1XaW5kb3dzIiwibGVuZ3RoIiwibGFib3VyTXVsdGlwbGllciIsImxhYm91ckNvc3QiLCJtYXRlcmlhbHNSZXN1bHQiLCJtYXRlcmlhbHNDb3N0Iiwic3BlY2lmaWNhdGlvbnNDb3N0IiwicmVkdWNlIiwidG90YWwiLCJzcGVjIiwic3BlY0Nvc3QiLCJnbGFzc011bHRpcGxpZXIiLCJzdWJ0b3RhbCIsInNlcnZpY2VGZWUiLCJ0b3RhbEJlZm9yZVZBVCIsInZhdCIsInRvdGFsUHJpY2UiLCJicmVha2Rvd24iLCJ3aW5kb3dDb3N0cyIsInNwZWNpZmljYXRpb25Db3N0cyIsImdsYXNzVHlwZU11bHRpcGxpZXIiLCJiYXNlVG90YWwiLCJ2ZWhpY2xlQmFzZWRQcmljZSIsImZpbmFsUHJpY2UiLCJ1cGRhdGVEYXRhIiwidXBkYXRlRXJyb3IiLCJmcm9tIiwidXBkYXRlIiwicXVvdGVfcHJpY2UiLCJzZXJ2aWNlX3R5cGUiLCJnbGFzc190eXBlIiwib3RyX3ByaWNlIiwiZXEiLCJzZWxlY3QiLCJpbnNlcnREYXRhIiwiaW5zZXJ0RXJyb3IiLCJpbnNlcnQiLCJxdW90ZV9pZCIsImNyZWF0ZWRfYXQiLCJ0b0lTT1N0cmluZyIsInVwZGF0ZWRfYXQiLCJzdXBhYmFzZUVycm9yIiwic3VjY2VzcyIsInByaWNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/calculate-quote.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcalculate-quote&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fcalculate-quote.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();